version: '3'

tasks:
  setup:
    desc: Install all dependencies (Python + Go + Tools)
    cmds:
      - echo "ğŸ“¦ Installing dependencies..."
      - uv sync
      - cmd: go mod download
        ignore_error: true # Only if go.mod exists
      - task: generate:api

  dev:
    desc: Start development server
    cmds:
      - echo "ğŸš€ Starting dev server..."
      - cd services/backend && task dev

  test:
    desc: Run all tests
    cmds:
      - echo "ğŸ§ª Running tests..."
      - cd services/backend && task test
      # Future: cd packages/api-client && npm test

  generate:api:
    desc: Generate API Client from OpenAPI spec
    cmds:
      - echo "âš™ï¸ Generating API client..."
      - uv run openapi-python-client generate --path api/openapi.yaml --output-path packages/{{ project_name_sanitized }}_api/src/{{ project_name_sanitized }}_api --overwrite --meta none
      - uv sync --reinstall-package {{ project_name_sanitized }}_api

  db:migrate:
    desc: Run database migrations
    cmds:
      - cd services/backend && task db:migrate
